<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>ğŸ  Home Chore Quest 2026</title>
  <style>
    :root{
      --bg:#f4f6f8; --card:#ffffff; --accent:#6c5ce7; --cat:#ffeaa7; --danger:#d63031;
    }
    body{font-family:-apple-system,BlinkMacSystemFont,'Segoe UI',Roboto,Helvetica,Arial,sans-serif;background:var(--bg);margin:0;padding:24px;color:#2d3436}
    h1{text-align:center;margin-bottom:4px}
    .subtitle{text-align:center;color:#636e72;margin-bottom:16px}
    .top-bar{display:flex;flex-wrap:wrap;gap:12px;justify-content:space-between;align-items:center;margin-bottom:16px}
    select,button{padding:8px 12px;border-radius:8px;border:1px solid #dfe6e9;background:#fff}
    button.primary{background:var(--accent);color:#fff;border:none;cursor:pointer}
    .calendar{display:grid;grid-template-columns:repeat(auto-fit,minmax(260px,1fr));gap:16px}
    .day{background:var(--card);border-radius:16px;padding:16px;box-shadow:0 10px 25px rgba(0,0,0,.08)}
    .today{outline:3px solid var(--accent)}
    .task{display:flex;align-items:center;margin-bottom:6px;font-size:.95rem}
    .task input{margin-right:8px;transform:scale(1.2)}
    .task small{margin-left:auto;color:#888}
    .cat{background:var(--cat);border-radius:12px;padding:10px;margin-top:12px}
    .important{color:var(--danger);font-weight:700}
    .panel{margin-top:20px;background:var(--card);border-radius:16px;padding:16px;box-shadow:0 10px 25px rgba(0,0,0,.08)}
    footer{margin-top:24px;text-align:center;font-size:.8rem;color:#999}
  </style>
</head>
<body>

<h1>ğŸ  Home Chore Quest Â· 2026</h1>
<div class="subtitle">Weekly fairness Â· Monthly truth Â· Cat meds are sacred ğŸ±</div>

<div class="top-bar">
  <div>ğŸ‘¤ Player: <select id="userSelect"></select></div>
  <div>ğŸ“† Week: <select id="weekSelect"></select></div>
  <div>
    <button class="primary" onclick="saveChanges()">ğŸ’¾ Save</button>
    <span id="saveStatus" style="margin-left:8px;color:#636e72"></span>
  </div>
</div>

<div class="calendar" id="calendar"></div>

<div class="panel">
  <h2>ğŸ† Weekly Ranking</h2>
  <div style="font-size:.85rem;color:#636e72;margin-bottom:8px">
    â€¢ Normal task = 1 pt<br>
    â€¢ ğŸ’Š Cat Med (æ—©ä¸Š / å¤œæ™š) = 3 pts each<br>
    â€¢ ğŸš° é£²æ°´æ©Ÿï¼‹Filter = 2 pts
  </div>
  <div id="ranking"></div>
</div>

<footer>Shared cloud data Â· Firebase + GitHub Pages Â· 2026</footer>

<!-- Firebase SDKs -->
<script src="https://www.gstatic.com/firebasejs/10.12.4/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/10.12.4/firebase-auth-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/10.12.4/firebase-database-compat.js"></script>

<script>
/******** FIREBASE ********/
const firebaseConfig={apiKey:"AIzaSyAfiCqoATodKlRkMJbTxAAXwhiNWplx5hQ",authDomain:"home-chore-quest-2026.firebaseapp.com",databaseURL:"https://home-chore-quest-2026-default-rtdb.firebaseio.com",projectId:"home-chore-quest-2026",storageBucket:"home-chore-quest-2026.firebasestorage.app",messagingSenderId:"380059427052",appId:"1:380059427052:web:4ef1a6339121a570b845c9"};
firebase.initializeApp(firebaseConfig);
const auth=firebase.auth();
const db=firebase.database();
const ROOM_ID="home-2026-main";
const dataRef=db.ref(`choreQuest/${ROOM_ID}`);

/******** CONFIG ********/
const YEAR=2026;
const players=["Dennis","Sharon","Robert"];
const days=["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"];

const tasks={
  general:[
    "ğŸ½ æ¸…æ´—ç¢—ç›¤ â†’ æ”¾å…¥æ´—ç¢—æ©Ÿ",
    "ğŸ½ æ´—ç¢—æ©Ÿå®Œæˆå¾Œ â†’ æ”¾å›ç¢—æ«ƒ",
    "ğŸ§º æ´—è¡£å¾Œ â†’ æ¸…ç†æ´—è¡£æ©Ÿ",
    "ğŸ§º ä¹¾è¡£å®Œæˆ â†’ å–èµ°è¡£ç‰©",
    "ğŸ‘• æ‘ºè¡«",
    "ğŸ§¹ å¸å¡µ",
    "ğŸ›‹ åŸ·å¥½æ¢³åŒ–",
    "ğŸª‘ åŸ·å¥½å…©å¼µæ±",
    "ğŸ³ æŠ¹çˆé ­",
    "ğŸ½ æŠ¹å»šæˆ¿æ±é¢",
    "ğŸ§Š æ¸…ç†é›ªæ«ƒéæœŸé£Ÿç‰©",
    "ğŸ—‘ å€’åƒåœ¾ï¼‹æ›è¢‹",
    "ğŸš½ æ¸…ç†å»æ‰€",
    "ğŸ“¦ æ¸…ç†å»šæˆ¿é›œç‰© â†’ æ”¾å›æ«ƒ"
  ],
  cat:[
    {name:"ğŸ’Š Cat Med â€“ æ—©ä¸Š é¤µè—¥",important:true,pts:3},
    {name:"ğŸ’Š Cat Med â€“ å¤œæ™š é¤µè—¥",important:true,pts:3},
    {name:"ğŸ± æ›æ°´ç¢—ï¼ˆæ¯ 2â€“3 æ—¥ä¸€æ¬¡ï¼‰"},
    {name:"ğŸ± æ´—ç³§é£Ÿå…œï¼ˆæ¯ 2â€“3 æ—¥ä¸€æ¬¡ï¼‰"},
    {name:"ğŸ± åŠ ç³§å…¥ç³§æ©Ÿ"},
    {name:"ğŸ± åŸ·å±ï¼‹æ¸…å±è¢‹"},
    {name:"ğŸ± åŸ·å°¿"},
    {name:"ğŸ± é™ªç© 10 åˆ†é˜"},
    {name:"ğŸ± ç–æ¯› 10 åˆ†é˜"},
    {name:"ğŸ± å‰ªæŒ‡ç”²"},
    {name:"ğŸ± æ²–æ¶¼"},
    {name:"ğŸš° æ¸…æ´—é£²æ°´æ©Ÿï¼‹æ› Filterï¼ˆæ¯æœˆ 15 è™Ÿï¼‰",important:true,pts:2}
  ]
};

let data={weeks:{}};
let pending={};
let ready=false;

function getWeekNumber(d=new Date()){
  const oneJan=new Date(YEAR,0,1);
  return Math.ceil((((d-oneJan)/86400000)+oneJan.getDay()+1)/7);
}
function wk(k){return `${YEAR}-W${k}`}

/******** CLOUD SYNC ********/
auth.signInAnonymously().then(()=>{
  dataRef.on("value",snap=>{
    data=snap.val()||{weeks:{}};
    ready=true;
    render();
  });
});

/******** UI ********/
const cal=document.getElementById('calendar');
const rank=document.getElementById('ranking');
const userSel=document.getElementById('userSelect');
const weekSel=document.getElementById('weekSelect');

players.forEach(p=>{const o=document.createElement('option');o.textContent=p;userSel.appendChild(o)});
for(let i=1;i<=53;i++){const o=document.createElement('option');o.value=wk(i);o.textContent=`Week ${i}`;if(i===getWeekNumber())o.selected=true;weekSel.appendChild(o)}

function toggle(day,task){
  if(!ready) return;
  const u=userSel.value;
  const w=weekSel.value;
  if(!pending[w]) pending[w]={};
  const key=day+task;
  const base=data.weeks[w]?.completed?.[key]||[];
  let next=[...base];
  next.includes(u)? next=next.filter(x=>x!==u): next.push(u);
  pending[w][key]=next;
  render();
}

async function saveChanges(){
  const w=weekSel.value;
  if(!pending[w]) return;
  if(!data.weeks[w]) data.weeks[w]={completed:{}};
  Object.entries(pending[w]).forEach(([k,v])=>{
    v.length? data.weeks[w].completed[k]=v: delete data.weeks[w].completed[k];
  });
  pending[w]={};
  await dataRef.child('weeks').child(w).set(data.weeks[w]);
  document.getElementById('saveStatus').textContent='Saved âœ”';
  setTimeout(()=>document.getElementById('saveStatus').textContent='',1200);
}

function render(){
  if(!ready) return;
  cal.innerHTML=''; rank.innerHTML='';
  const w=weekSel.value;
  const week=data.weeks[w]||{completed:{}};
  const scores={Dennis:0,Sharon:0,Robert:0};

  days.forEach(d=>{
    const card=document.createElement('div'); card.className='day';
    card.innerHTML=`<h3>${d}</h3>`;
    tasks.general.forEach(t=>{
      const k=d+t; const done=week.completed[k]||[];
      done.forEach(u=>scores[u]++);
      card.innerHTML+=`<div class='task'><input type='checkbox' ${done.includes(userSel.value)?'checked':''} onclick="toggle('${d}','${t}')">${t}<small>${done.join(', ')}</small></div>`;
    });
    let catHtml=`<div class='cat'>`;
    tasks.cat.forEach(t=>{
      const k=d+t.name; const done=week.completed[k]||[];
      done.forEach(u=>scores[u]+=(t.pts||1));
      catHtml+=`<div class='task'><input type='checkbox' ${done.includes(userSel.value)?'checked':''} onclick="toggle('${d}','${t.name}')"><span class='${t.important?'important':''}'>${t.name}</span><small>${done.join(', ')}</small></div>`;
    });
    catHtml+='</div>';
    card.innerHTML+=catHtml;
    cal.appendChild(card);
  });

  Object.entries(scores).forEach(([p,s])=>{
    rank.innerHTML+=`<div>${p}: <strong>${s} pts</strong></div>`;
  });
}
</script>
</body>
</html>
