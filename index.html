<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>ğŸ  Home Chore Quest 2026</title>
  <style>
    :root {
      --bg: #f4f6f8;
      --card: #ffffff;
      --accent: #6c5ce7;
      --cat: #ffeaa7;
      --danger: #d63031;
    }
    body {
      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Helvetica, Arial, sans-serif;
      background: var(--bg);
      margin: 0;
      padding: 24px;
      color: #2d3436;
    }
    h1 { text-align: center; margin-bottom: 4px; }
    .subtitle { text-align: center; color: #636e72; margin-bottom: 20px; }
    .top-bar { display:flex; flex-wrap:wrap; gap:12px; justify-content:space-between; margin-bottom:16px; }
    select, button { padding:8px 12px; border-radius:8px; border:1px solid #dfe6e9; background:white; }
    button.primary { background:var(--accent); color:white; border:none; cursor:pointer; }
    .calendar { display:grid; grid-template-columns:repeat(auto-fit,minmax(260px,1fr)); gap:16px; }
    .day { background:var(--card); border-radius:16px; padding:16px; box-shadow:0 10px 25px rgba(0,0,0,.08); }
    .today { outline:3px solid var(--accent); }
    .task { display:flex; align-items:center; margin-bottom:6px; font-size:.95rem; }
    .task input { margin-right:8px; transform:scale(1.2); }
    .task small { margin-left:auto; color:#888; }
    .cat { background:var(--cat); border-radius:12px; padding:10px; margin-top:12px; }
    .important { color:var(--danger); font-weight:700; }
    .panel { margin-top:24px; background:var(--card); border-radius:16px; padding:16px; box-shadow:0 10px 25px rgba(0,0,0,.08); }
    footer { margin-top:24px; text-align:center; font-size:.8rem; color:#999; }
  </style>
</head>
<body>

<h1>ğŸ  Home Chore Quest Â· 2026</h1>
<div class="subtitle">Weekly fairness Â· Monthly truth Â· Cat meds are sacred ğŸ±</div>

<div class="top-bar">
  <div>ğŸ‘¤ Player: <select id="userSelect"></select></div>
  <div>ğŸ“† Week: <select id="weekSelect"></select></div>
  <div><button class="primary" onclick="saveChanges()">ğŸ’¾ Save</button> <span id="saveStatus"></span></div>
</div>

<div class="calendar" id="calendar"></div>

<div class="panel">
  <h2>ğŸ† Weekly Ranking</h2>
  <div id="ranking"></div>
</div>

<footer>Shared cloud data Â· Firebase + GitHub Pages</footer>

<!-- Firebase SDKs -->
<script src="https://www.gstatic.com/firebasejs/10.12.4/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/10.12.4/firebase-auth-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/10.12.4/firebase-database-compat.js"></script>

<script>
/**************** FIREBASE SETUP ****************/
const firebaseConfig = {
  apiKey: "AIzaSyAfiCqoATodKlRkMJbTxAAXwhiNWplx5hQ",
  authDomain: "home-chore-quest-2026.firebaseapp.com",
  databaseURL: "https://home-chore-quest-2026-default-rtdb.firebaseio.com",
  projectId: "home-chore-quest-2026",
  storageBucket: "home-chore-quest-2026.firebasestorage.app",
  messagingSenderId: "380059427052",
  appId: "1:380059427052:web:4ef1a6339121a570b845c9"
};

firebase.initializeApp(firebaseConfig);
const auth = firebase.auth();
const db = firebase.database();

const ROOM_ID = "home-2026-main";
const dataRef = db.ref(`choreQuest/${ROOM_ID}`);

/**************** APP DATA ****************/
const YEAR = 2026;
const players = ["Dennis","Sharon","Robert"];
const days = ["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"];

const tasks = {
  general: ["ğŸ½ æ´—ç¢— â†’ æ”¾å…¥æ´—ç¢—æ©Ÿ","ğŸ§º æ´—è¡£","ğŸ‘• æ‘ºè¡«","ğŸ§¹ å¸å¡µ","ğŸ—‘ å€’åƒåœ¾","ğŸš½ æ¸…ç†å»æ‰€"],
  cat: [
    { name: "ğŸ’Š Cat Med â€“ æ—©ä¸Š", important:true },
    { name: "ğŸ’Š Cat Med â€“ å¤œæ™š", important:true },
    { name: "ğŸ± åŸ·å±" },
    { name: "ğŸ± åŸ·å°¿" }
  ]
};

let data = { weeks:{} };
let pending = {};
let cloudReady = false;

/**************** HELPERS ****************/
function getWeekNumber(d=new Date()){
  const oneJan=new Date(YEAR,0,1);
  return Math.ceil((((d-oneJan)/86400000)+oneJan.getDay()+1)/7);
}
function weekKey(w){ return `${YEAR}-W${w}`; }

/**************** CLOUD SYNC ****************/
auth.signInAnonymously().then(()=>{
  dataRef.on("value",snap=>{
    data = snap.val() || { weeks:{} };
    cloudReady = true;
    render();
  });
});

/**************** UI ****************/
const calendarEl=document.getElementById("calendar");
const rankingEl=document.getElementById("ranking");
const userSelect=document.getElementById("userSelect");
const weekSelect=document.getElementById("weekSelect");

players.forEach(p=>{
  const o=document.createElement('option'); o.textContent=p; userSelect.appendChild(o);
});

for(let i=1;i<=53;i++){
  const o=document.createElement('option'); o.value=weekKey(i); o.textContent=`Week ${i}`;
  if(i===getWeekNumber()) o.selected=true;
  weekSelect.appendChild(o);
}

function toggle(day,task){
  if(!cloudReady) return;
  const user=userSelect.value;
  const wk=weekSelect.value;
  if(!pending[wk]) pending[wk]={};
  const key=day+task;
  const base=(data.weeks[wk]?.completed?.[key])||[];
  let next=[...base];
  if(next.includes(user)) next=next.filter(u=>u!==user);
  else next.push(user);
  pending[wk][key]=next;
  render();
}

async function saveChanges(){
  const wk=weekSelect.value;
  if(!pending[wk]) return;
  if(!data.weeks[wk]) data.weeks[wk]={completed:{}};
  Object.entries(pending[wk]).forEach(([k,v])=>{
    if(v.length===0) delete data.weeks[wk].completed[k];
    else data.weeks[wk].completed[k]=v;
  });
  pending[wk]={};
  await dataRef.child("weeks").child(wk).set(data.weeks[wk]);
  document.getElementById('saveStatus').textContent="Saved âœ”";
  setTimeout(()=>document.getElementById('saveStatus').textContent="",1200);
}

function render(){
  if(!cloudReady) return;
  calendarEl.innerHTML="";
  rankingEl.innerHTML="";
  const wk=weekSelect.value;
  const week=data.weeks[wk]||{completed:{}};

  const scores={ Dennis:0,Sharon:0,Robert:0 };

  days.forEach(day=>{
    const card=document.createElement('div'); card.className='day';
    card.innerHTML=`<h3>${day}</h3>`;
    tasks.general.forEach(t=>{
      const key=day+t;
      const done=week.completed[key]||[];
      done.forEach(u=>scores[u]++);
      card.innerHTML+=`<div class='task'><input type='checkbox' ${done.includes(userSelect.value)?'checked':''} onclick="toggle('${day}','${t}')">${t}<small>${done.join(', ')}</small></div>`;
    });
    let cat=`<div class='cat'>`;
    tasks.cat.forEach(t=>{
      const key=day+t.name;
      const done=week.completed[key]||[];
      done.forEach(u=>scores[u]+=t.important?3:1);
      cat+=`<div class='task'><input type='checkbox' ${done.includes(userSelect.value)?'checked':''} onclick="toggle('${day}','${t.name}')"><span class='${t.important?'important':''}'>${t.name}</span><small>${done.join(', ')}</small></div>`;
    }); cat+=`</div>`;
    card.innerHTML+=cat;
    calendarEl.appendChild(card);
  });

  Object.entries(scores).forEach(([p,s])=>{
    rankingEl.innerHTML+=`<div>${p}: <strong>${s} pts</strong></div>`;
  });
}
</script>
</body>
</html>
